import os
os.environ["CUDA_VISIBLE_DEVICES"]="0"
from TensorMol import *
import numpy as np

PARAMS["tf_prec"] = "tf.float64"
#net = UniversalNetwork_v2(name="SF_Universal_ForDis_Tue_Feb_04_10.01.34_2020")
net = UniversalNetwork_v2(name="SF_Universal_ForDis_Tue_Feb_04_20.07.07_2020")

# Barebone
m1 = Mol()

bv = """20

C          1.47384       -0.25559        0.16845
C          2.35394        0.86225        0.74992
C          2.12508        1.36725        1.98604
C          1.06782        0.95656        2.92228
C          0.62714       -0.52870        3.09562
C          1.21354       -1.60663        2.30420
C          1.59202       -1.52780        1.00472
C         -0.32743        0.51788        2.46766
C         -0.73791        0.47349        1.05347
C          0.00786        0.17379       -0.02678
H          1.34602       -2.56425        2.80146
H          2.76127        2.17527        2.33928
H          0.37562       -0.80217        4.11455
H          1.06843        1.51219        3.85444
H         -1.13816        0.83082        3.11525
H          1.86412       -0.50278       -0.81574
H          1.98065       -2.37247        0.55693
H         -0.39794        0.23112       -0.97392
H         -1.72670        0.70207        0.86624
H          3.13465        1.23551        0.18762"""

bv_meth = """32

C          0.52155       -0.20646        0.38060
C          1.76897        0.62924        0.67502
C          1.94775        1.26215        1.86551
C          0.97243        1.27133        2.99717
C          0.14969        0.06508        3.38453
C          0.23341       -1.21165        2.65890
C          0.39725       -1.38616        1.33300
C         -0.52619        1.28816        2.80533
C         -1.15575        1.29417        1.47594
C         -0.73365        0.65002        0.37083
H          0.15184       -2.09820        3.28490
H          0.01188       -0.08240        4.45372
H          1.31632        1.87551        3.83652
H         -1.08064        1.89488        3.51860
H          0.63278       -0.62691       -0.62943
H         -2.06144        1.89340        1.40310
C          2.73446        0.67973       -0.48290
H          3.22498       -0.29129       -0.60501
H          3.50660        1.44493       -0.38350
H          2.19869        0.91438       -1.40979
C         -1.47065        0.74118       -0.93311
H         -0.82114        1.16276       -1.70713
H         -2.35952        1.37670       -0.86235
H         -1.79714       -0.25314       -1.25462
C          0.46855       -2.75247        0.71605
H          1.42121       -2.88329        0.19257
H         -0.34640       -2.88671       -0.00263
H          0.38822       -3.54872        1.46342
C          3.21656        2.02950        2.18081
H          4.07474        1.72169        1.57934
H          3.51600        1.86383        3.22228
H          3.05063        3.10218        2.03929"""

bv4 = """62

C          1.47384       -0.25559        0.16845
C          2.35394        0.86225        0.74992
C          2.12508        1.36725        1.98604
C          1.06782        0.95656        2.92228
C          0.62714       -0.52870        3.09562
C          1.21354       -1.60663        2.30420
C          1.59202       -1.52780        1.00472
C         -0.32743        0.51788        2.46766
C         -0.73791        0.47349        1.05347
C          0.00786        0.17379       -0.02678
H          1.34602       -2.56425        2.80146
H          2.76127        2.17527        2.33928
H          0.37562       -0.80217        4.11455
H          1.06843        1.51219        3.85444
H         -1.13816        0.83082        3.11525
H          1.86412       -0.50278       -0.81574
C          3.48747        1.37118       -0.07004
C          3.36567        1.54921       -1.46336
C          4.71823        1.70690        0.53248
C          5.77689        2.21537       -0.22439
C          5.63490        2.39509       -1.60518
C          4.42404        2.05804       -2.22071
H          2.42943        1.31186       -1.95752
H          4.30105        2.19506       -3.29070
H          6.45849        2.78537       -2.19451
H          6.71682        2.45788        0.26192
H          4.84983        1.53873        1.59627
C         -0.51524        0.18376       -1.45663
C         -1.40128        1.35174       -1.83685
H         -1.04744       -0.75754       -1.65358
H          0.35693        0.18742       -2.12631
C         -2.48618        1.25540       -2.61424
H         -3.06540        2.12886       -2.89716
H         -2.83491        0.29795       -2.99500
H         -1.08567        2.32607       -1.46572
C          2.13008       -2.76659        0.39719
O          2.31617       -3.83870        0.99898
O          2.41434       -2.62685       -0.94710
C          2.94069       -3.81670       -1.65557
C          1.80391       -4.72101       -2.11179
H          1.27448       -5.13522       -1.24940
H          2.20486       -5.55389       -2.70173
H          1.09228       -4.16910       -2.73385
H          3.62250       -4.34039       -0.98127
H          3.49365       -3.38971       -2.49386
O         -2.11224        0.88267        0.94257
C         -3.06500        0.01722        0.46637
O         -2.87658       -1.13306        0.06365
O         -4.26242        0.65377        0.52965
C         -5.43507       -0.09308        0.01706
C         -6.62541        0.86359        0.02840
H         -5.59542       -0.96089        0.66510
H         -5.20230       -0.44929       -0.99200
C         -6.39649        2.06269       -0.90928
H         -5.48493        2.60201       -0.63710
H         -7.24135        2.75907       -0.85930
H         -6.29844        1.72691       -1.95040
C         -7.90493        0.08878       -0.34598
H         -8.77513        0.75368       -0.31997
H         -8.09542       -0.74151        0.34483
H         -7.83198       -0.32345       -1.36086
H         -6.73214        1.23972        1.05586"""

methanol = """27

C         -2.76392        0.60956        0.01281
C         -2.10452       -0.74893       -0.08113
H         -1.69348       -1.04607        0.88938
H         -1.26918       -0.72396       -0.78851
H         -2.82038       -1.50849       -0.40775
C          1.21808        2.81835        0.02284
C          2.58025        3.45588       -0.15313
H          1.06780        2.01816       -0.70891
H          0.42323        3.55853       -0.10456
H          1.12700        2.36515        1.01531
C          2.61423       -0.89161       -0.00375
C          2.18941       -2.33341       -0.17432
H          3.66462       -0.75868       -0.27763
H          2.47452       -0.56363        1.03165
H          2.00081       -0.23704       -0.63059
O          0.82404       -2.46063        0.18944
H          0.57783       -3.39177        0.06357
H          2.78775       -2.98877        0.46498
H          2.30504       -2.64412       -1.21688
O         -1.80876        1.56610        0.44749
H         -2.27932        2.40579        0.56840
H         -3.58884        0.58511        0.73103
H         -3.14832        0.91810       -0.96381
O          3.60697        2.49991        0.06873
H          3.43475        1.74963       -0.52503
H          2.71585        4.27214        0.56203
H          2.69332        3.85953       -1.16371"""
#m1.FromXYZString(bv)
#m1.FromXYZString(bv_meth)
#m1.FromXYZString(bv4)



meth_un="""27

C         -2.62832        0.60229        0.00951
C         -2.12016       -0.66831        0.05273
H         -1.73266       -0.91551        0.63737
H         -1.69495       -0.20652       -0.74000
H         -2.98706       -1.21488       -0.15341
C          1.34572        2.83005        0.06797
C          2.70691        3.53865       -0.16856
H          1.31765        2.22891       -0.33950
H          0.20477        4.15419       -0.46759
H          1.03040        2.56522        1.13108
C          2.68499       -0.89735       -0.04923
C          2.12199       -2.39951       -0.02533
H          3.45648       -0.76399       -0.63514
H          3.12411       -0.46038        1.23483
H          1.98551        0.28491       -0.49069
O          0.77999       -2.46124        0.19339
H          0.75676       -3.54999       -0.31837
H          2.45593       -3.12167       -0.15603
H          2.01805       -2.57547       -1.42645
O         -1.88297        1.54419        0.46367
H         -2.28458        2.39854        0.84387
H         -3.36822       -0.16882        0.74868
H         -3.08406        1.30282       -0.80722
O          3.59643        2.41666       -0.04358
H          3.01506        2.22288       -0.06571
H          2.25764        4.47416        0.20278
H          3.16380        3.71093       -1.29346"""
DA="""29

C         -2.05758        0.21427       -0.03907
C         -0.74675       -0.49265       -0.09240
C         -2.17113        1.54270       -0.04403
C         -1.01264        2.50931       -0.11912
C          0.43934        0.39599        0.26980
C          0.37901        1.84227       -0.26977
H          0.53357        0.42069        1.36263
H          1.35268       -0.08724       -0.10361
H         -0.61772       -0.91463       -1.09543
H         -0.77012       -1.33822        0.60560
C         -1.11023        3.51730        1.03712
H         -1.18505        3.06443       -1.05327
C         -0.66874        4.90765        0.59319
H         -0.56246        3.18537        1.92583
H         -2.15512        3.61105        1.36366
C          0.82440        5.15162        0.40852
H         -1.02718        5.62899        1.34022
H         -1.19626        5.17506       -0.33160
C          1.75010        4.05538       -0.11842
H          1.22353        5.50183        1.36885
H          0.93028        6.01329       -0.26670
C          1.55018        2.62491        0.36593
H          2.76217        4.34956        0.19932
H          1.77439        4.07378       -1.21297
H          1.48668        2.60566        1.46072
H          2.47253        2.07677        0.12570
H          0.57661        1.77827       -1.35079
H         -3.17032        1.97879       -0.02494
H         -2.95545       -0.40061       -0.01018"""

name = "Nose"
PARAMS["MDdt"] = 0.05 # In fs.
PARAMS["MDMaxStep"] = 20000
#PARAMS["MDThermostat"]="Andersen"
PARAMS["MDThermostat"]="Nose"
#PARAMS["MDThermostat"]=None
PARAMS["MDV0"]="Thermal"
Temp = 2000
PARAMS["MDTemp"]=Temp
if 0:
    name += "bv"
    m1.FromXYZString(bv)
elif 0:
    name += "bv_meth"
    m1.FromXYZString(bv_meth)
elif 0:
    name += "bv4"
    m1.FromXYZString(bv4)
elif 1:
    name += "DA"
    m1.FromXYZString(DA)
name += str(Temp)
EF = net.get_energy_force_function(m1)
if 1:
    MD = VelocityVerlet(EF, m1, name_=name, EandF_=EF)
    MD.Prop()
elif 0:
    name += "zero"
#    PARAMS["MDThermostat"]=None
#    PARAMS["MDTemp"] = 0
    MD = VelocityVerlet(EF, m1, name_=name, EandF_=EF)
#    print(MD.f0)
    MD.Prop()
elif 1:
    PARAMS["OptThresh"] = 0.001
    PARAMS["OptMaxCycles"] = 500
    Opt = GeomOptimizer(EF)
    m=Opt.OptGD(m1,name,eff_max_step=500)

